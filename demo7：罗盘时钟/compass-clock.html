<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title></title>
    <script type="text/javascript" src="./vue.js"></script>
    <style>
      html, body {
        padding: 0;
        margin: 0;
      }
      html::-webkit-scrollbar {
        display: none;
        height: 0;
        width: 0;
      }
      #app {
        width: 100vw;
        height: 100vh;
        background-color: #000;
        color: #71767d;
        position: relative;
        overflow: hidden;

      }
      .box {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        border-radius: 50%;
        /*border: 1px solid rgba(255, 255, 255, 0.7);*/
      }
      .area {
        position: relative;
        width: 100%;
        height: 100%;
        transition: all 1s;
      }
      .area span {
        position: absolute;
        white-space: nowrap;
        font-size: 14px;
        box-sizing: border-box;
        display: inline-block;
        width: 50px;
        text-align: center;
        transition: all 1s;
        padding: 15px;
        /*display: none;*/
      }
      .area span.select {
        font-size: 18px;
        font-weight: bold;
        color: #FFD700;
      }
      .area .time {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .area .time label {
        white-space: nowrap;
        font-weight: bold;
        color: #FFD700;
        box-sizing: border-box;
        display: inline-block;
        width: 50px;
        transition: all 0.3s;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        /*设置等宽字体*/
        font-family: Consolas, Monaco, monospace;
        word-break: break-all;
      }
      .num {
        position: absolute;
        left: 50%;
        top: 50%;
        font-size: 150px;
        font-family: Consolas, Monaco, monospace;
        transform: translate(-50%, -50%) scale(0);
        /*color: #FFD700;*/
        font-weight: bold;
        transition: all 3s;
        opacity: 1;
      }
      .hide {
        transform: translate(-50%, -50%) scale(3);
        opacity: 0;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="box" :style="setBoxStyle(700)" >
        <div class="area" :style="{ transform: `rotate(${curSecondDeg}deg)` }">
          <span v-for="(item, index) in seconds" :keys="index" :class="{ select: index === curSecond }" ref="second">{{item}}{{index !== 0 ? '秒' : ''}}</span>
        </div>
      </div>
      <div class="box" :style="setBoxStyle(540)">
        <div class="area" :style="{ transform: `rotate(${curMinuteDeg}deg)` }">
          <span v-for="(item, index) in minutes" :keys="index" :class="{ select: index === curMinute }" ref="minute">{{item}}{{index !== 0 ? '分' : ''}}</span>
        </div>
      </div>
      <div class="box" :style="setBoxStyle(380)">
        <div class="area" :style="{ transform: `rotate(${curHourDeg}deg)` }">
          <span v-for="(item, index) in hours" :keys="index" :class="{ select: index === curHour }" ref="hour">{{item}}{{index !== 0 ? '时' : ''}}</span>
        </div>
      </div>
      <div class="box" :style="setBoxStyle(240)">
        <div class="area" :style="{ transform: `rotate(${curDayDeg}deg)` }">
          <span v-for="(item, index) in days" :keys="index" :class="{ select: (index + 1) === curDay }" ref="day">{{item}}日</span>
        </div>
      </div>
      <div class="box" :style="setBoxStyle(100)">
        <div class="area" :style="{ transform: `rotate(${curMonthDeg}deg)` }">
          <span v-for="(item, index) in months" :keys="index" :class="{ select: (index + 1) === curMonth }" ref="month">{{item}}月</span>
        </div>
      </div>
      <div class="box" :style="setBoxStyle(50)" style="border: 0;">
        <div class="area" >
          <div class="time">
            <label>{{curYear}}</label>
            <label>周{{curWeek}}</label>
          </div>
        </div>
      </div>
    </div>
    <script>
      var VueModel = new Vue({
        el: '#app',
        data: {
          curSecond: 0,
          curMinute: 0,
          curHour: 0,
          curDay: 1,
          curMonth: 1,
          curYear: 2021,
          curWeek: '一',
          timer: null,
          curSecondDeg: 0,
          curMinuteDeg: 0,
          curHourDeg: 0,
          curDayDeg: 0,
          curMonthDeg: 0,
          i: 0,
          colors: ['#FFFFE0', '#FFFACD', '#FFF8DC', '#FFEFD5', '#FAEBD7']
        },
        computed: {
          seconds() {
            return Array.from({ length: 60 }).map((item, index) => this.changeChina(index))
          },
          minutes() {
            return Array.from({ length: 60 }).map((item, index) => this.changeChina(index))
          },
          hours() {
            return Array.from({ length: 24 }).map((item, index) => this.changeChina(index))
          },
          days() {
            const date = new Date()
            date.setDate(date.getMonth() + 1)
            date.setDate(0)
            const day = date.getDate()
            let days = Array.from({ length: day + 1 }).map((item, index) => this.changeChina(index, false))
            days.shift()
            return days
          },
          months() {
            let months = Array.from({ length: 13 }).map((item, index) => this.changeChina(index, false))
            months.shift()
            return months
          }
        },
        mounted() {
          this.createAnima()
          this.asyncTimes()
            .then(() => {
              this.init()
              return this.asyncTimes(500)
            }).then(() => {
              this.init()
              return this.asyncTimes(500)
            })
            .then(() => {
              this.init()
              return this.asyncTimes(500)
            })
            .then(() => {
              this.setData()
            })
        },
        methods: {
          asyncTimes(times = 1000) {
            return new Promise(resolve => {
              setTimeout(() => {
                resolve()
              }, times)
            })
          },
          createAnima() {
            // 秒
            this.$refs.second.forEach((item, index) => {
              this.asyncTimes(12 * index).then(() => {
                const data = this.setStyle(index, this.seconds.length, 700)
                item.style = Object.keys(data).reduce((acc, item) => acc += `${item}: ${data[item]};`, '')
              })
            })
            // 分钟
            this.$refs.minute.forEach((item, index) => {
              this.asyncTimes(14 * index).then(() => {
                const data = this.setStyle(index, this.minutes.length, 540)
                item.style = Object.keys(data).reduce((acc, item) => acc += `${item}: ${data[item]};`, '')
              })
            })
            // 小时
            this.$refs.hour.forEach((item, index) => {
              this.asyncTimes(16 * index).then(() => {
                const data = this.setStyle(index, this.hours.length, 380)
                item.style = Object.keys(data).reduce((acc, item) => acc += `${item}: ${data[item]};`, '')
              })
            })
            // 天
            this.$refs.day.forEach((item, index) => {
              this.asyncTimes(18 * index).then(() => {
                const data = this.setStyle(index, this.days.length, 240)
                item.style = Object.keys(data).reduce((acc, item) => acc += `${item}: ${data[item]};`, '')
              })
            })
            // 月份
            this.$refs.month.forEach((item, index) => {
              this.asyncTimes(100 * index).then(() => {
                const data = this.setStyle(index, this.months.length, 100)
                item.style = Object.keys(data).reduce((acc, item) => acc += `${item}: ${data[item]};`, '')
              })
            })
          },
          init(i) {
            // 随机旋转
            this.curSecondDeg = Math.random() * 360
            this.curMinuteDeg = Math.random() * 360
            this.curHourDeg = Math.random() * 360
            this.curDayDeg = Math.random() * 360
            this.curMonthDeg = Math.random() * 360
          },
          setData() {
            const date = new Date()
            const month = date.getMonth() + 1
            const day = date.getDate()
            const hour = date.getHours()
            const minute = date.getMinutes()
            const second = date.getSeconds()
            const year = date.getFullYear()
            const week = date.getDay()

            this.curSecond = second
            this.curMinute = minute
            this.curHour = hour
            this.curDay = day
            this.curMonth = month
            this.curYear = year
            this.curWeek = ['日', '一', '二', '三', '四', '五', '六'][week]
            // 设置角度
            this.asyncTimes(500)
              .then(() => {
                this.curMonthDeg = this.setDegs(month - 1, this.months.length)
                return this.asyncTimes(120).then(() => {
                  this.createDom(this.months[this.curMonth - 1] + '月', 120)
                })
              })
              .then(() => {
                this.curDayDeg = this.setDegs(day - 1, this.days.length)
                return this.asyncTimes(300).then(() => {
                  this.createDom(this.days[this.curDay - 1] + '日', 300)
                })
              })
              .then(() => {
                this.curHourDeg = this.setDegs(hour, this.hours.length)
                return this.asyncTimes(240).then(() => {
                  this.createDom(this.hours[this.curHour - 1] + '時', 240)
                })
              })
              .then(() => {
                this.curMinuteDeg = this.setDegs(minute, this.minutes.length)
                return this.asyncTimes(450).then(() => {
                  this.createDom(this.minutes[this.curMinute] + '分', 450)
                })
              })
              .then(() => {
                this.curSecondDeg = this.setDegs(second, this.seconds.length)
                return this.asyncTimes(450).then(() => {
                  this.createDom(this.seconds[this.curSecond] + '秒', 450)
                })
              })
              .then(() => {
                this.setTimer()
              })
          },

          setTimer() {
            this.i = new Date().getSeconds() // 获取当前秒数
            this.timer = setInterval(() => {
              this.i += 1
              const date = new Date()
              const month = date.getMonth() + 1
              const day = date.getDate()
              const hour = date.getHours()
              const minute = date.getMinutes()
              const second = date.getSeconds()

              this.curSecond = second
              this.curMinute = minute
              this.curHour = hour
              this.curDay = day
              this.curMonth = month
              this.curYear = date.getFullYear()

              // 设置角度
              this.curSecondDeg = this.setDegs(second, this.seconds.length) - Math.floor(this.i / 60) * 360
              this.curMinuteDeg = this.setDegs(minute, this.minutes.length) - Math.floor(this.i / (60 * 60)) * 360
              this.curHourDeg = this.setDegs(hour, this.hours.length) - Math.floor(this.i / (60 * 60 * 24)) * 360
              this.curDayDeg = this.setDegs(day - 1, this.days.length) - Math.floor(this.i / (60 * 60 * 24 * 30)) * 360
              this.curMonthDeg = this.setDegs(month - 1, this.months.length) - Math.floor(this.i / (60 * 60 * 24 * 30 * 12)) * 360
            }, 1000)

            // 记得清除定时器
            this.$once('hook:beforeDestroy', () => {
              clearInterval(this.timer)
            })
          },
          createDom(text, time) {
            const div = document.createElement('div')
            div.classList = 'num'
            div.innerText = text
            const color = parseInt(Math.random() * this.colors.length)
            div.style.color = this.colors[color]
            this.colors.splice(color, 1)
            document.body.appendChild(div)
            this.asyncTimes(time).then(() => {
              div.classList += ' hide'
            })
          },
          setDegs(target, length) {
            return 360 - (360 / length) * target + 90
          },
          changeChina(num, hasZero = true) {
            const number = ['零', '一', '二', '三', '四', '五', '六', '七', '八', '九']
            const ten = '十'
            if (num < 10) {
              return `${hasZero ? '零' : ''}${number[num]}`
            } else {
              const [tenNum, oneNum] = String(num).split('')
              return `${tenNum !== '1' ? number[tenNum] : ''}${ten}${oneNum !== '0' ? number[oneNum] : ''}`
            }
          },
          setBoxStyle(size) {
            return {
              width: `${size}px`,
              height: `${size}px`
            }
          },
          setStyle(index, allLength, w) {
            // 根据勾股定理，可以算出
            // 每个点的x坐标为 半径 * sin 角度
            // 每个点的y坐标为 半径 * cos 角度
            // 则
            const r = 0.5 * w
            const radius = 360 / allLength // 一个单位的角度
            const deg = radius * index
            const radian = (2 * Math.PI * deg) / 360
            // 使用sin 跟 cos 求值，注意这里需要传弧度而非角度
            const x = r * Math.sin(radian)
            const y = r * Math.cos(radian)
            return {
              left: `${r + x}px`,
              top: `${r - y}px`,
              transform: `rotate(${deg - 90
              }deg)`,
              'transform-origin': `0 0`,
              display: 'block'
            }
          }
        }
      })
    </script>
  </body>
</html>
